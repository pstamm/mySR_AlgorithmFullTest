function resize_canvas(e){var t=e.offsetWidth,n=e.offsetHeight,r=document.getElementById("canvasId");r.width=t,r.height=n}async function buttonCameraClick(e){if("Stop"!=e.target.innerText)try{videoStream=await navigator.mediaDevices.getUserMedia(constraints),detector=null,handleSuccess(videoStream),buttonCamera.style.background="red",e.target.innerText="Stop"}catch(e){alert("No available devices detected!")}else stopStreamedVideo(video),setTimeout(function(){var e=canvas.getContext("2d");e.clearRect(0,0,canvas.width,canvas.height)},imageProcessingRateToCanvasMs+10),buttonCamera.style.background="green",e.target.innerText="Start camera","none"!=imageArrow.style.display&&(imageArrow.style.display="none",messageMarkerNumber.innerHTML="");setAllObjectsPositionOnCanvas()}function getOrientation(){return window.matchMedia("(orientation: portrait)").matches?"portrait":window.matchMedia("(orientation: landscape)").matches?"landscape":""}function orientationChanged(){"landscape"==lastOrientation?(markerLastKnown={marker:null,detectionTime:null,consecutiveReadings:0},markerLastAccepted={marker:null,detectionTime:null},imageArrow.style.display="none",messageMarkerNumber.innerHTML="",divContainer.style.display="none",divLandscapeMessage.style.display="block"):(divLandscapeMessage.style.display="none",divContainer.style.display="inline")}function setAllObjectsPositionOnCanvas(){centerDomObjectOnContainer(buttonCamera,video,50,90),centerDomObjectOnContainer(messageMarkerNumber,video,50,2),"none"!=imageArrow.style.display&&centerDomObjectOnContainer(imageArrow,video,50,50,50)}function centerDomObjectOnContainer(e,t,n,r,a){var i=t.getBoundingClientRect(),o=e.getBoundingClientRect();null==n&&(n=0),null==r&&(r=0);var s=i.right-i.left,d=i.bottom-i.top;if(null!=a&&0!=a){var c=s/o.width,l=d/o.height,m=a/100,g=o.width*c*m,u=o.height*l*m;g<1&&(g=1),u<1&&(u=1),e.width=g,e.height=u,o=e.getBoundingClientRect()}e.style.position="fixed",e.style.zindex="2";var v=i.left+s*(n/100)-o.width/2,h=i.top+d*(r/100)-o.height/2;null!=v&&null!=h&&(v<i.left&&(v=i.left),h<i.top&&(h=i.top),v+o.width>i.right&&(v-=v+o.width-i.right),h+o.height>i.bottom&&(h-=h+o.height-i.bottom),e.style.left=v+"px",e.style.top=h+"px")}function drawTextOnCanvasCenteredOn(e,t,n,r,a,i,o,s){e.font=i+" "+o+"px "+a,e.fillStyle=s;var d=n-e.measureText(t).width/2,c=r-o/2;e.fillText(t,d,c)}function drawRectangle(e,t,n,r,a,i,o){e.lineWidth=""+o,e.strokeStyle=i,e.strokeRect(t,n,r,a)}function findMarkers(e){var t=!1;null==detector&&(detector=new SR.Detector);var n=detector.detect(e,markerMaxReturned,markerMinSideSize,maxAllowedPercentDiffBetweenSides,epsilon,warpSize);if(n.length>0)null!=markerLastKnown.marker&&n[0].id==markerLastKnown.marker.id?markerLastKnown.consecutiveReadings++:markerLastKnown.consecutiveReadings=1,markerLastKnown.marker=n[0],markerLastKnown.detectionTime=new Date,markerLastKnown.consecutiveReadings>=markerAcceptedAfterConsecutiveReadings?(markerLastKnown.consecutiveReadings==markerAcceptedAfterConsecutiveReadings&&(t=!0,angleBeforeChange=markerLastKnown.marker.angle),markerLastAccepted.marker=markerLastKnown.marker,markerLastAccepted.detectionTime=markerLastKnown.detectionTime):(markerLastAccepted.marker=null,markerLastAccepted.detectionTime=null);else{var r=new Date;null!=markerLastAccepted.detectionTime&&r-markerLastAccepted.detectionTime>markerValidForMs&&(markerLastKnown.consecutiveReadings=0,markerLastAccepted.marker=null,markerLastAccepted.detectionTime=null)}if(null!=markerLastAccepted.detectionTime&&(n=[],n.push(markerLastAccepted.marker)),null!=markerLastAccepted.marker){markerLastAccepted.marker.borderWhite&&"(I) ",messageMarkerNumber.innerHTML=markerLastAccepted.marker.id,Math.abs(markerLastAccepted.marker.angle-angleBeforeChange)>minAngleChangeToRotateArrow&&(imageArrow.style.transform="rotate("+markerLastAccepted.marker.angle+"deg)",angleBeforeChange=markerLastAccepted.marker.angle,setAllObjectsPositionOnCanvas())}else imageArrow.style.display="none",messageMarkerNumber.innerHTML="";t&&(t=!1,newMarkerDetected(markerLastKnown.marker))}function newMarkerDetected(e){"none"==imageArrow.style.display&&(imageArrow.width=imageArrowWidth,imageArrow.height=imageArrowHeight,imageArrow.style.display="inline",imageArrow.style.transformOrigin="center center",imageArrow.style.webkitTransformOrigin="center center",imageArrow.style.transform="rotate("+e.angle+"deg)",setAllObjectsPositionOnCanvas(),playSound("click"))}function playSound(e){document.getElementById(e).play()}function drawCorners(e,t){var n,r,a,i;for(e.lineWidth="3",a=0;a!==t.length;++a){for(n=t[a].corners,e.strokeStyle="blue",e.beginPath(),i=0;i!==n.length;++i)r=n[i],e.moveTo(r.x,r.y),r=n[(i+1)%n.length],e.lineTo(r.x,r.y);e.stroke(),e.closePath(),e.strokeStyle="green",e.strokeRect(n[0].x-2,n[0].y-2,4,4)}}function drawId(e,t){var n,r,a,i,o,s;for(e.strokeStyle="red",e.lineWidth=1,o=0;o!==t.length;++o){for(n=t[o].corners,a=1/0,i=1/0,s=0;s!==n.length;++s)r=n[s],a=Math.min(a,r.x),i=Math.min(i,r.y);e.strokeText(t[o].id,a,i)}}function handleSuccess(e){const t=document.querySelector("video");t.setAttribute("autoplay",""),t.setAttribute("muted",""),t.setAttribute("playsinline",""),window.stream=e,t.srcObject=e,t.onloadedmetadata=function(e){t.play()}}function handleError(e){if("ConstraintNotSatisfiedError"===e.name){constraints.video;errorMsg("The resolution ${v.width.exact}x${v.height.exact} px is not supported by your device.")}else"PermissionDeniedError"===e.name&&errorMsg("Permissions have not been granted to use your camera and microphone, you need to allow the page access to your devices in order for the demo to work.");errorMsg("getUserMedia error: ${error.name}",e)}function errorMsg(e,t){const n=document.querySelector("#errorMsg");n.innerHTML+="<p>${msg}</p>",void 0!==t&&console.error(t)}function stopStreamedVideo(e){const t=e.srcObject,n=t.getTracks();n.forEach(function(e){e.stop()}),e.srcObject=null}function stopVideoOnly(e){e.getTracks().forEach(function(e){"live"==e.readyState&&"video"===e.kind&&e.stop()})}function stopAudioOnly(e){e.getTracks().forEach(function(e){"live"==e.readyState&&"audio"===e.kind&&e.stop()})}function markerHtmlTableCreation(e,t){const n=50;var r=document.getElementById(e);r.innerHTML="";var a=document.createElement("label");if(t.success){var i=document.createElement("table");i.cellspacing=0,i.cellpadding=0,i.style.border="4px solid black",i.style.borderCollapse="collapse";for(var o=0;o<t.markerArray.length;o++){var s=i.insertRow();s.height=n,s.style.border="none";for(var d=0;d<t.markerArray[0].length;d++){var c=s.insertCell();c.width=n,c.height=n,c.style.border="none";var l="0"==t.markerArray[o][d]?"white":"black";c.style.backgroundColor=l}}a.innerText=t.markerNumber+" "+(t.whiteBorder?"White":"Black"),a.appendChild(i)}else a.innerText="Invalid marker data ("+t.markerNumber+")";r.appendChild(a),r.appendChild(document.createElement("br"))}const markerMaxReturned=1,markerMinSideSize=14,maxAllowedPercentDiffBetweenSides=40,warpSize=49,epsilon=.05,markerValidForMs=3e3,markerAcceptedAfterConsecutiveReadings=2,minAngleChangeToRotateArrow=5,imageProcessingRateToCanvasMs=250;var canvas=document.getElementById("canvasId"),ctx=canvas.getContext("2d"),video=document.getElementById("videoId"),buttonCamera=document.getElementById("buttonCameraId"),messageMarkerNumber=document.getElementById("messageMarkerNumber");messageMarkerNumber.innerHTML="";var divContainer=document.getElementById("divContainerId"),divLandscapeMessage=document.getElementById("divLandscapeMessageId");divLandscapeMessage.style.display="none";var imageArrow=document.getElementById("imageArrowId");imageArrow.src="images/arrow.png",imageArrow.style.display="none";var videoStream,imageArrowWidth=imageArrow.width,imageArrowHeight=imageArrow.height;setTimeout(function(){imageArrowWidth=imageArrow.width,imageArrowHeight=imageArrow.height},500),document.querySelector("#buttonCameraId").addEventListener("click",e=>buttonCameraClick(e));var detector=null;window.addEventListener("load",e=>{setAllObjectsPositionOnCanvas(),setTimeout(function(){setAllObjectsPositionOnCanvas()},100)});var lastOrientation=getOrientation();orientationChanged(),window.addEventListener("resize",function(e){var t=getOrientation();lastOrientation!=t&&(lastOrientation=t,orientationChanged()),setAllObjectsPositionOnCanvas()}),window.addEventListener("scroll",function(e){setAllObjectsPositionOnCanvas()}),video.addEventListener("loadedmetadata",function(){canvas.width=video.videoWidth,canvas.height=video.videoHeight}),video.addEventListener("play",function(){setAllObjectsPositionOnCanvas();var e=this;(function t(){e.paused||e.ended||("landscape"!=lastOrientation&&(ctx.drawImage(e,0,0),setTimeout(function(){findMarkers(ctx.getImageData(0,0,canvas.width,canvas.height))},1)),setTimeout(t,imageProcessingRateToCanvasMs))})()},0);var markerLastKnown={marker:null,detectionTime:null,consecutiveReadings:0},markerLastAccepted={marker:null,detectionTime:null},angleBeforeChange=0;const constraints=window.constraints={audio:!1,video:{facingMode:"environment"}};