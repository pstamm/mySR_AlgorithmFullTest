var CV=CV||{};CV.Image=function(t,r,e){this.width=t||0,this.height=r||0,this.data=e||[]},CV.grayscale=function(t,r){for(var e=t.data,n=r.data,i=e.length,o=0,a=0;o<i;o+=4)n[a++]=.299*e[o]+.587*e[o+1]+.114*e[o+2]+.5&255;return r.width=t.width,r.height=t.height,r},CV.threshold=function(t,r,e){var n,i=t.data,o=r.data,a=i.length,d=[];for(n=0;n<256;++n)d[n]=n<=e?0:255;for(n=0;n<a;++n)o[n]=d[i[n]];return r.width=t.width,r.height=t.height,r},CV.adaptiveThreshold=function(t,r,e,n){var i,o=t.data,a=r.data,d=o.length,h=[];for(CV.stackBoxBlur(t,r,e),i=0;i<768;++i)h[i]=i-255<=-n?255:0;for(i=0;i<d;++i)a[i]=h[o[i]-a[i]+255];return r.width=t.width,r.height=t.height,r},CV.otsu=function(t){var r,e,n,i=t.data,o=i.length,a=[],d=0,h=0,x=0,u=0,f=0,s=0;for(n=0;n<256;++n)a[n]=0;for(n=0;n<o;++n)a[i[n]]++;for(n=0;n<256;++n)h+=a[n]*n;for(n=0;n<256;++n)if(u+=a[n],0!==u){if(f=o-u,0===f)break;x+=a[n]*n,r=x/u-(h-x)/f,e=u*f*r*r,e>s&&(s=e,d=n)}return d},CV.stackBoxBlurMult=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265],CV.stackBoxBlurShift=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13],CV.BlurStack=function(){this.color=0,this.next=null},CV.stackBoxBlur=function(t,r,e){var n,i,o,a,d,h,x,u,f,s,l=t.data,g=r.data,c=t.height,y=t.width,C=c-1,V=y-1,_=e+e+1,w=e+1,v=CV.stackBoxBlurMult[e],B=CV.stackBoxBlurShift[e];for(n=i=new CV.BlurStack,s=1;s<_;++s)n=n.next=new CV.BlurStack;for(n.next=i,d=0,f=0;f<c;++f){for(h=d,o=l[d],a=w*o,n=i,s=0;s<w;++s)n.color=o,n=n.next;for(s=1;s<w;++s)n.color=l[d+s],a+=n.color,n=n.next;for(n=i,u=0;u<y;++u)g[d++]=a*v>>>B,x=u+w,x=h+(x<V?x:V),a-=n.color-l[x],n.color=l[x],n=n.next}for(u=0;u<y;++u){for(d=u,h=d+y,o=g[d],a=w*o,n=i,s=0;s<w;++s)n.color=o,n=n.next;for(s=1;s<w;++s)n.color=g[h],a+=n.color,n=n.next,h+=y;for(n=i,f=0;f<c;++f)g[d]=a*v>>>B,x=f+w,x=u+(x<C?x:C)*y,a-=n.color-g[x],n.color=g[x],n=n.next,d+=y}return r},CV.gaussianBlur=function(t,r,e,n){var i=CV.gaussianKernel(n);return r.width=t.width,r.height=t.height,e.width=t.width,e.height=t.height,CV.gaussianBlurFilter(t,e,i,!0),CV.gaussianBlurFilter(e,r,i,!1),r},CV.gaussianBlurFilter=function(t,r,e,n){var i,o,a,d,h,x=t.data,u=r.data,f=t.height,s=t.width,l=0,g=e.length>>1;for(a=0;a<f;++a)for(d=0;d<s;++d){for(o=0,h=-g;h<=g;++h)n?(i=l+h,d+h<0?i=l:d+h>=s&&(i=l)):(i=l+h*s,a+h<0?i=l:a+h>=f&&(i=l)),o+=e[g+h]*x[i];u[l++]=n?o:o+.5&255}return r},CV.gaussianKernel=function(t){var r,e,n,i,o,a,d=[[1],[.25,.5,.25],[.0625,.25,.375,.25,.0625],[.03125,.109375,.21875,.28125,.21875,.109375,.03125]],h=[];if(t<=7&&t%2==1)h=d[t>>1];else{for(r=.5*(t-1),e=.8+.3*(r-1),n=-.5/(e*e),i=0,a=0;a<t;++a)o=a-r,i+=h[a]=Math.exp(n*o*o);for(i=1/i,a=0;a<t;++a)h[a]*=i}return h},CV.findContours=function(t,r){var e,n,i,o,a,d,h,x,u,f=t.width,s=t.height,l=[];for(e=CV.binaryBorder(t,r),n=CV.neighborhoodDeltas(f+2),i=f+3,a=1,x=0;x<s;++x,i+=2)for(u=0;u<f;++u,++i)o=e[i],0!==o&&(d=h=!1,1===o&&0===e[i-1]?d=!0:o>=1&&0===e[i+1]&&(h=!0),(d||h)&&(++a,l.push(CV.borderFollowing(e,i,a,{x:u,y:x},h,n))));return l},CV.borderFollowing=function(t,r,e,n,i,o){var a,d,h,x,u,f=[];f.hole=i,x=u=i?0:4;do{if(x=x-1&7,a=r+o[x],0!==t[a])break}while(x!==u);if(x===u)t[r]=-e,f.push({x:n.x,y:n.y});else for(d=r,4^x;;){u=x;do{h=d+o[++x]}while(0===t[h]);if(x&=7,x-1>>>0<u>>>0?t[d]=-e:1===t[d]&&(t[d]=e),f.push({x:n.x,y:n.y}),x,n.x+=CV.neighborhood[x][0],n.y+=CV.neighborhood[x][1],h===r&&d===a)break;d=h,x=x+4&7}return f},CV.neighborhood=[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]],CV.neighborhoodDeltas=function(t){for(var r=[],e=CV.neighborhood.length,n=0;n<e;++n)r[n]=CV.neighborhood[n][0]+CV.neighborhood[n][1]*t;return r.concat(r)},CV.approxPolyDP=function(t,r){var e,n,i,o,a,d,h,x,u,f,s,l={start_index:0,end_index:0},g={start_index:0,end_index:0},c=[],y=[],C=t.length;for(r*=r,s=0,u=0;u<3;++u)for(a=0,s=(s+g.start_index)%C,n=t[s],++s===C&&(s=0),f=1;f<C;++f)e=t[s],++s===C&&(s=0),h=e.x-n.x,x=e.y-n.y,o=h*h+x*x,o>a&&(a=o,g.start_index=f);for(a<=r?c.push({x:n.x,y:n.y}):(l.start_index=s,l.end_index=g.start_index+=l.start_index,g.start_index-=g.start_index>=C?C:0,g.end_index=l.start_index,g.end_index<g.start_index&&(g.end_index+=C),y.push({start_index:g.start_index,end_index:g.end_index}),y.push({start_index:l.start_index,end_index:l.end_index}));0!==y.length;){if(l=y.pop(),i=t[l.end_index%C],n=t[s=l.start_index%C],++s===C&&(s=0),l.end_index<=l.start_index+1)d=!0;else{for(a=0,h=i.x-n.x,x=i.y-n.y,u=l.start_index+1;u<l.end_index;++u)e=t[s],++s===C&&(s=0),o=Math.abs((e.y-n.y)*h-(e.x-n.x)*x),o>a&&(a=o,g.start_index=u);d=a*a<=r*(h*h+x*x)}d?c.push({x:n.x,y:n.y}):(g.end_index=l.end_index,l.end_index=g.start_index,y.push({start_index:g.start_index,end_index:g.end_index}),y.push({start_index:l.start_index,end_index:l.end_index}))}return c},CV.warp=function(t,r,e,n){var i,o,a,d,h,x,u,f,s,l,g,c,y,C,V,_,w,v,B,p,b,k,q,M=t.data,m=r.data,F=t.width,P=t.height,S=0;for(y=CV.getPerspectiveTransform(e,n-1),C=y[8],V=y[2],_=y[5],k=0;k<n;++k)for(C+=y[7],V+=y[1],_+=y[4],w=C,v=V,B=_,q=0;q<n;++q)w+=y[6],v+=y[0],B+=y[3],p=v/w,b=B/w,i=p>>>0,o=i===F-1?i:i+1,a=p-i,d=1-a,h=b>>>0,x=h===P-1?h:h+1,u=b-h,f=1-u,s=l=h*F,g=c=x*F,m[S++]=f*(d*M[s+i]+a*M[l+o])+u*(d*M[g+i]+a*M[c+o])&255;return r.width=n,r.height=n,r},CV.getPerspectiveTransform=function(t,r){var e=CV.square2quad(t);return e[0]/=r,e[1]/=r,e[3]/=r,e[4]/=r,e[6]/=r,e[7]/=r,e},CV.square2quad=function(t){var r,e,n,i,o,a,d,h=[];return r=t[0].x-t[1].x+t[2].x-t[3].x,e=t[0].y-t[1].y+t[2].y-t[3].y,0===r&&0===e?(h[0]=t[1].x-t[0].x,h[1]=t[2].x-t[1].x,h[2]=t[0].x,h[3]=t[1].y-t[0].y,h[4]=t[2].y-t[1].y,h[5]=t[0].y,h[6]=0,h[7]=0,h[8]=1):(n=t[1].x-t[2].x,i=t[3].x-t[2].x,o=t[1].y-t[2].y,a=t[3].y-t[2].y,d=n*a-i*o,h[6]=(r*a-i*e)/d,h[7]=(n*e-r*o)/d,h[8]=1,h[0]=t[1].x-t[0].x+h[6]*t[1].x,h[1]=t[3].x-t[0].x+h[7]*t[3].x,h[2]=t[0].x,h[3]=t[1].y-t[0].y+h[6]*t[1].y,h[4]=t[3].y-t[0].y+h[7]*t[3].y,h[5]=t[0].y),h},CV.isContourConvex=function(t){var r,e,n,i,o,a,d,h,x=0,u=!0,f=t.length,s=0,l=0;for(e=t[f-1],r=t[0],o=r.x-e.x,a=r.y-e.y;s<f;++s){if(++l===f&&(l=0),e=r,r=t[l],d=r.x-e.x,h=r.y-e.y,n=d*a,i=h*o,x|=i>n?1:i<n?2:3,3===x){u=!1;break}o=d,a=h}return u},CV.perimeter=function(t){for(var r,e,n=t.length,i=0,o=n-1,a=0;i<n;o=i++)r=t[i].x-t[o].x,e=t[i].y-t[o].y,a+=Math.sqrt(r*r+e*e);return a},CV.minEdgeLength=function(t){for(var r,e,n,i=t.length,o=0,a=i-1,d=1/0;o<i;a=o++)e=t[o].x-t[a].x,n=t[o].y-t[a].y,r=e*e+n*n,r<d&&(d=r);return Math.sqrt(d)},CV.edgeLengthDiferencePercentage=function(t){for(var r,e,n,i=t.length,o=0,a=i-1,d=1/0,h=-1/0;o<i;a=o++)e=t[o].x-t[a].x,n=t[o].y-t[a].y,r=e*e+n*n,r<d&&(d=r),r>h&&(h=r);return 100-100*Math.sqrt(d)/Math.sqrt(h)},CV.countNonZero=function(t,r){var e,n,i=t.data,o=r.height,a=r.width,d=r.x+r.y*t.width,h=t.width-a,x=0;for(e=0;e<o;++e){for(n=0;n<a;++n)0!==i[d++]&&++x;d+=h}return x},CV.countNonOne=function(t,r){var e,n,i=t.data,o=r.height,a=r.width,d=r.x+r.y*t.width,h=t.width-a,x=0;for(e=0;e<o;++e){for(n=0;n<a;++n)0==i[d++]&&++x;d+=h}return x},CV.binaryBorder=function(t,r){var e,n,i=t.data,o=t.height,a=t.width,d=0,h=0;for(n=-2;n<a;++n)r[h++]=0;for(e=0;e<o;++e){for(r[h++]=0,n=0;n<a;++n)r[h++]=0===i[d++]?0:1;r[h++]=0}for(n=-2;n<a;++n)r[h++]=0;return r};